<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIå°è¯´è‡ªåŠ¨åˆ›ä½œç³»ç»Ÿ - ç›‘ç£æ¨¡å¼</title>
    <link rel="stylesheet" href="auto-novel-styles.css">
</head>
<body>
    <div class="app-container">
        <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
        <header class="control-bar">
            <div class="header-left">
                <h1 class="app-title">ğŸ¤– AIå°è¯´è‡ªåŠ¨åˆ›ä½œç³»ç»Ÿ</h1>
                <div class="status-indicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="systemStatus">å¾…æœºä¸­</span>
                </div>
            </div>
            <div class="header-right">
                <button id="startBtn" class="btn-start">â–¶ï¸ å¼€å§‹åˆ›ä½œ</button>
                <button id="pauseBtn" class="btn-pause" disabled>â¸ï¸ æš‚åœ</button>
                <button id="themeToggle" class="btn-icon" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
                <button id="settingsBtn" class="btn-icon">âš™ï¸</button>
            </div>
        </header>

        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šé¡¹ç›®ä¿¡æ¯å’Œè¿›åº¦ -->
            <aside class="project-panel">
                <div class="panel-section">
                    <h2>ğŸ“š é¡¹ç›®ä¿¡æ¯</h2>
                    <div class="project-info">
                        <div class="info-item">
                            <label>å°è¯´åç§°ï¼š</label>
                            <input type="text" id="novelTitle" class="input-field" placeholder="è¾“å…¥å°è¯´æ ‡é¢˜">
                        </div>
                        <div class="info-item">
                            <label>å°è¯´ç±»å‹ï¼š</label>
                            <select id="novelType" class="input-field">
                                <option value="mystery">æ¨ç†æ‚¬ç–‘</option>
                                <option value="urban-suspense">éƒ½å¸‚æ‚¬ç–‘</option>
                                <option value="adventure">æ¢é™©å†’é™©</option>
                                <option value="tomb-raiding">ç›—å¢“é¢˜æ</option>
                                <option value="antique">å¤è‘£æ–‡ç‰©</option>
                                <option value="xuanhuan">ç„å¹»</option>
                                <option value="fantasy">å¥‡å¹»</option>
                                <option value="revolution-era">é©å‘½æ—¶ä»£</option>
                                <option value="historical">å†å²é¢˜æ</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>å°è¯´ç¯‡å¹…ï¼š</label>
                            <select id="novelLength" class="input-field">
                                <option value="short">çŸ­ç¯‡ï¼ˆ1-20ç« ï¼‰</option>
                                <option value="medium">ä¸­ç¯‡ï¼ˆ21-40ç« ï¼‰</option>
                                <option value="long">é•¿ç¯‡ï¼ˆ40-60ç« ï¼‰</option>
                                <option value="infinite">æ— é™ç»­å†™æ¨¡å¼ï¼ˆ60ç« ä»¥ä¸Šï¼‰</option>
                            </select>
                        </div>
                        <div class="info-item">
                            <label>åˆå§‹æ¦‚å¿µï¼š</label>
                            <textarea id="initialConcept" class="input-field" rows="3" 
                                placeholder="ç®€è¿°ä½ çš„å°è¯´åˆ›æ„..."></textarea>
                        </div>
                        <div class="info-item">
                            <label>å†™ä½œé£æ ¼ï¼š</label>
                            <select id="writerStyle" class="input-field">
                                <option value="">é»˜è®¤é£æ ¼</option>
                                <option value="bhxl-style">æ¸¤æµ·å°å - å†å²è¶£è°ˆ</option>
                                <option value="dbl-style">ä¸¹Â·å¸ƒæœ— - æ‚¬ç–‘æƒŠæ‚š</option>
                                <option value="dnmy-style">å½“å¹´æ˜æœˆ - å¹½é»˜å†å²</option>
                                <option value="dygw-style">ä¸œé‡åœ­å¾ - æ¨ç†å°è¯´</option>
                                <option value="hm-style">ä½•é©¬ - å†’é™©æ¢ç§˜</option>
                                <option value="zjc-style">ç´«é‡‘é™ˆ - ç°å®æ‚¬ç–‘</option>
                                <option value="custom">è‡ªå®šä¹‰é£æ ¼</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>ğŸ“Š åˆ›ä½œè¿›åº¦</h2>
                    <div class="workflow-progress">
                        <div class="stage-item" data-stage="concept">
                            <div class="stage-icon">ğŸ›ï¸</div>
                            <div class="stage-info">
                                <h4>æ¦‚å¿µæ„å»º</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="stage-item" data-stage="planning">
                            <div class="stage-icon">ğŸ“‹</div>
                            <div class="stage-info">
                                <h4>è¯¦ç»†è§„åˆ’</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="stage-item" data-stage="creation">
                            <div class="stage-icon">âœï¸</div>
                            <div class="stage-info">
                                <h4>å†…å®¹åˆ›ä½œ</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="stage-item" data-stage="revision">
                            <div class="stage-icon">ğŸ”§</div>
                            <div class="stage-info">
                                <h4>ä¿®è®¢å®Œå–„</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="stage-item" data-stage="forward">
                            <div class="stage-icon">ğŸ”®</div>
                            <div class="stage-info">
                                <h4>å‰ç»è§„åˆ’</h4>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>âš¡ å¿«é€Ÿæ“ä½œ</h2>
                    <div class="quick-actions">
                        <button class="action-btn" id="exportBtn">ğŸ“„ å¯¼å‡ºä¸ºMarkdown</button>
                        <button class="action-btn" id="saveBtn">ğŸ’¾ ä¿å­˜è¿›åº¦</button>
                        <button class="action-btn" id="loadBtn">ğŸ“ åŠ è½½é¡¹ç›®</button>
                    </div>
                </div>
            </aside>

            <!-- ä¸­å¤®ï¼šAIå·¥ä½œæµæ˜¾ç¤º -->
            <main class="workflow-display">
                <div class="workflow-header">
                    <h2 id="currentTask">å½“å‰ä»»åŠ¡ï¼šç­‰å¾…å¼€å§‹</h2>
                    <div class="task-timer">
                        <span>â±ï¸ ç”¨æ—¶ï¼š</span>
                        <span id="taskTimer">00:00</span>
                    </div>
                </div>

                <div class="workflow-content">
                    <!-- AIæ‰§è¡Œæ—¥å¿— -->
                    <div class="execution-log" id="executionLog">
                        <div class="log-entry welcome">
                            <div class="log-time">ç³»ç»Ÿ</div>
                            <div class="log-content">
                                æ¬¢è¿ä½¿ç”¨AIå°è¯´è‡ªåŠ¨åˆ›ä½œç³»ç»Ÿï¼
                                <br><br>
                                æœ¬ç³»ç»Ÿå°†è‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„å°è¯´åˆ›ä½œæµç¨‹ï¼š
                                <ol>
                                    <li>é¦–å¸­æ¶æ„å¸ˆæ„å»ºä¸–ç•Œè§‚</li>
                                    <li>è§’è‰²å¡‘é€ å¸ˆè®¾è®¡äººç‰©</li>
                                    <li>æƒ…èŠ‚è§„åˆ’å¸ˆåˆ¶å®šå¤§çº²</li>
                                    <li>å™äº‹æ‰§è¡Œè€…æ’°å†™å†…å®¹</li>
                                    <li>è¿ç»­æ€§ç›‘ç£å®˜æ£€æŸ¥ä¸€è‡´æ€§</li>
                                    <li>è´¨é‡è¯„ä¼°å®˜è¯„ä»·è´¨é‡</li>
                                    <li>åˆ›ä½œæ€»ç›‘åšæœ€ç»ˆå†³ç­–</li>
                                </ol>
                                è¯·å¡«å†™é¡¹ç›®ä¿¡æ¯åç‚¹å‡»"å¼€å§‹åˆ›ä½œ"ã€‚
                            </div>
                        </div>
                    </div>

                    <!-- äººç±»å®¡æ ¸åŒº -->
                    <div class="review-panel" id="reviewPanel" style="display: none;">
                        <div class="review-header">
                            <h3>ğŸ” éœ€è¦æ‚¨çš„å®¡æ ¸</h3>
                            <span class="review-role" id="reviewRole"></span>
                        </div>
                        <div class="review-content" id="reviewContent">
                            <!-- AIè¾“å‡ºå†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                        </div>
                        <div class="review-actions">
                            <button class="btn-approve" id="approveBtn">âœ… æ‰¹å‡†</button>
                            <button class="btn-modify" id="modifyBtn">âœï¸ ä¿®æ”¹å»ºè®®</button>
                            <button class="btn-reject" id="rejectBtn">âŒ é‡åš</button>
                        </div>
                        <div class="modify-input" id="modifyInput" style="display: none;">
                            <textarea id="modifyText" placeholder="è¯·è¾“å…¥æ‚¨çš„ä¿®æ”¹å»ºè®®..."></textarea>
                            <button class="btn-submit" id="submitModifyBtn">æäº¤ä¿®æ”¹</button>
                        </div>
                    </div>
                </div>
            </main>

            <!-- å³ä¾§ï¼šæˆæœå±•ç¤º -->
            <aside class="output-panel">
                <div class="output-tabs">
                    <button class="tab-btn active" data-tab="worldview">ä¸–ç•Œè§‚</button>
                    <button class="tab-btn" data-tab="characters">è§’è‰²</button>
                    <button class="tab-btn" data-tab="outline">å¤§çº²</button>
                    <button class="tab-btn" data-tab="chapters">ç« èŠ‚</button>
                </div>

                <div class="tab-content active" id="worldviewTab">
                    <h3>ğŸŒ ä¸–ç•Œè§‚è®¾å®š</h3>
                    <div id="worldviewContent" class="content-display">
                        <p class="placeholder">ç­‰å¾…AIæ„å»ºä¸–ç•Œè§‚...</p>
                    </div>
                </div>

                <div class="tab-content" id="charactersTab">
                    <h3>ğŸ‘¥ è§’è‰²æ¡£æ¡ˆ</h3>
                    <div id="charactersContent" class="content-display">
                        <p class="placeholder">ç­‰å¾…AIåˆ›å»ºè§’è‰²...</p>
                    </div>
                </div>

                <div class="tab-content" id="outlineTab">
                    <h3>ğŸ“ æ•…äº‹å¤§çº²</h3>
                    <div id="outlineContent" class="content-display">
                        <p class="placeholder">ç­‰å¾…AIè§„åˆ’æƒ…èŠ‚...</p>
                    </div>
                </div>

                <div class="tab-content" id="chaptersTab">
                    <h3>ğŸ“– ç« èŠ‚å†…å®¹</h3>
                    <div id="chaptersContent" class="content-display">
                        <p class="placeholder">ç­‰å¾…AIæ’°å†™ç« èŠ‚...</p>
                    </div>
                </div>
            </aside>
        </div>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <footer class="status-bar">
            <div class="status-left">
                <span>ğŸ“Š æ€»è¿›åº¦ï¼š</span>
                <span id="totalProgress">0%</span>
                <span class="status-separator">|</span>
                <span>ğŸ“– ç« èŠ‚ï¼š</span>
                <span id="currentChapter">0</span>
                <span>/</span>
                <span id="targetChapters">0</span>
            </div>
            <div class="status-center">
                <span>âœ… å·²å®Œæˆï¼š</span>
                <span id="completedTasks">0</span>
                <span>/ æ€»ä»»åŠ¡ï¼š</span>
                <span id="totalTasks">0</span>
            </div>
            <div class="status-right">
                <span>â° æ€»ç”¨æ—¶ï¼š</span>
                <span id="totalTime">00:00:00</span>
            </div>
        </footer>
    </div>

    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">ğŸ“‹</button>
    <button class="mobile-output-btn" id="mobileOutputBtn">ğŸ“š</button>
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç³»ç»Ÿè®¾ç½®</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <h4>APIé…ç½®</h4>
                    <div class="form-item">
                        <label>API æä¾›å•†</label>
                        <select id="apiProvider" class="input-field" onchange="switchAPIProvider()">
                            <option value="gemini">Google Gemini</option>
                            <option value="deepseek">DeepSeek</option>
                        </select>
                    </div>
                    
                    <!-- Gemini é…ç½® -->
                    <div id="geminiConfig" class="api-config">
                        <div class="form-item">
                            <label>Gemini API Key</label>
                            <input type="password" id="geminiApiKey" class="input-field" placeholder="è¾“å…¥ä½ çš„ Gemini API Key">
                        </div>
                        <div class="form-item">
                            <label>Gemini æ¨¡å‹</label>
                            <select id="geminiModel" class="input-field">
                                <option value="gemini-2.5-pro">Gemini 2.5 Pro - æœ€æ–°æœ€å¼º</option>
                                <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash (å®éªŒç‰ˆ) - æœ€å¿«é€Ÿ</option>
                                <option value="gemini-2.0-flash-thinking-exp-1219">Gemini 2.0 Flash Thinking (å®éªŒç‰ˆ) - æ·±åº¦æ€è€ƒ</option>
                                <option value="gemini-1.5-pro">Gemini 1.5 Pro - å¹³è¡¡æ€§èƒ½</option>
                                <option value="gemini-1.5-pro-002">Gemini 1.5 Pro 002 - æœ€æ–°ç¨³å®šç‰ˆ</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash - å¿«é€Ÿå“åº”</option>
                                <option value="gemini-1.5-flash-002">Gemini 1.5 Flash 002 - å¿«é€Ÿç¨³å®šç‰ˆ</option>
                                <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash 8B - è½»é‡çº§</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- DeepSeek é…ç½® -->
                    <div id="deepseekConfig" class="api-config" style="display: none;">
                        <div class="form-item">
                            <label>DeepSeek API Key</label>
                            <input type="password" id="deepseekApiKey" class="input-field" placeholder="è¾“å…¥ä½ çš„ DeepSeek API Key">
                        </div>
                        <div class="form-item">
                            <label>DeepSeek æ¨¡å‹</label>
                            <select id="deepseekModel" class="input-field">
                                <option value="deepseek-chat">DeepSeek Chat - å¯¹è¯æ¨¡å‹</option>
                                <option value="deepseek-coder">DeepSeek Coder - ä»£ç æ¨¡å‹</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label>API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" id="deepseekEndpoint" class="input-field" 
                                   placeholder="é»˜è®¤: https://api.deepseek.com/v1" 
                                   value="https://api.deepseek.com/v1">
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>è‡ªåŠ¨åŒ–è®¾ç½®</h4>
                    <div class="form-item">
                        <label>
                            <input type="checkbox" id="autoApprove" checked>
                            è‡ªåŠ¨æ‰¹å‡†ä½é£é™©å†³ç­–
                        </label>
                    </div>
                    <div class="form-item">
                        <label>
                            <input type="checkbox" id="pauseOnMilestone" checked>
                            åœ¨é‡è¦é‡Œç¨‹ç¢‘æš‚åœå®¡æ ¸
                        </label>
                    </div>
                    <div class="form-item">
                        <label>
                            <input type="checkbox" id="autoExportChapter" checked>
                            æ¯ç« å®Œæˆåè‡ªåŠ¨å¯¼å‡ºMarkdown
                        </label>
                    </div>
                    <div class="form-item">
                        <label>ä»»åŠ¡é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰</label>
                        <input type="number" id="taskInterval" value="2" min="0" max="60">
                    </div>
                </div>

                <div class="setting-group">
                    <h4>åˆ›ä½œå‚æ•°</h4>
                    <div class="form-item">
                        <label>åˆ›é€ æ€§ (0-2)</label>
                        <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.8">
                        <span id="tempValue">0.8</span>
                    </div>
                    <div class="form-item">
                        <label>æ¯ç« ç›®æ ‡å­—æ•°</label>
                        <input type="number" id="chapterWords" value="3000" min="1000" max="10000">
                    </div>
                </div>

                <div class="setting-group">
                    <h4>å†™ä½œé£æ ¼è®¾ç½®</h4>
                    <div class="form-item">
                        <label>è‡ªå®šä¹‰é£æ ¼æ–‡ä»¶ï¼ˆ.mdæ ¼å¼ï¼‰</label>
                        <input type="file" id="customStyleFile" accept=".md" style="width: 100%;">
                        <small style="color: #666;">ä¸Šä¼ è‡ªå®šä¹‰çš„ä½œå®¶é£æ ¼æç¤ºè¯æ–‡ä»¶</small>
                    </div>
                    <div class="form-item" id="customStyleStatus" style="display: none;">
                        <label>å·²åŠ è½½é£æ ¼ï¼š</label>
                        <span id="loadedStyleName" style="color: #4CAF50;"></span>
                        <button class="btn-cancel" onclick="clearCustomStyle()" style="margin-left: 10px; padding: 5px 10px;">æ¸…é™¤</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn-save" onclick="saveSettings()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script src="auto-novel-app.js"></script>
    <script>
        // API æä¾›å•†åˆ‡æ¢
        function switchAPIProvider() {
            const provider = document.getElementById('apiProvider').value;
            const geminiConfig = document.getElementById('geminiConfig');
            const deepseekConfig = document.getElementById('deepseekConfig');
            
            if (provider === 'gemini') {
                geminiConfig.style.display = 'block';
                deepseekConfig.style.display = 'none';
            } else if (provider === 'deepseek') {
                geminiConfig.style.display = 'none';
                deepseekConfig.style.display = 'block';
            }
        }

        // æ¸…é™¤è‡ªå®šä¹‰é£æ ¼
        function clearCustomStyle() {
            localStorage.removeItem('customStyleContent');
            localStorage.removeItem('customStyleName');
            document.getElementById('customStyleFile').value = '';
            document.getElementById('customStyleStatus').style.display = 'none';
            document.getElementById('writerStyle').value = '';
            // é€šçŸ¥ç³»ç»Ÿæ¸…é™¤é£æ ¼
            if (window.novelSystem) {
                window.novelSystem.project.style = '';
                window.novelSystem.project.styleContent = '';
            }
        }

        // å¤„ç†è‡ªå®šä¹‰é£æ ¼æ–‡ä»¶ä¸Šä¼ 
        document.addEventListener('DOMContentLoaded', function() {
            const customStyleFile = document.getElementById('customStyleFile');
            if (customStyleFile) {
                customStyleFile.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    if (!file.name.endsWith('.md')) {
                        alert('è¯·ä¸Šä¼  .md æ ¼å¼çš„æ–‡ä»¶');
                        this.value = '';
                        return;
                    }
                    
                    try {
                        const content = await file.text();
                        const fileName = file.name.replace('.md', '');
                        
                        // ä¿å­˜åˆ° localStorage
                        localStorage.setItem('customStyleContent', content);
                        localStorage.setItem('customStyleName', fileName);
                        
                        // æ˜¾ç¤ºå·²åŠ è½½çŠ¶æ€
                        document.getElementById('loadedStyleName').textContent = fileName;
                        document.getElementById('customStyleStatus').style.display = 'block';
                        
                        // è®¾ç½®ä¸‹æ‹‰æ¡†ä¸ºè‡ªå®šä¹‰
                        document.getElementById('writerStyle').value = 'custom';
                        
                        alert(`å·²æˆåŠŸåŠ è½½é£æ ¼æ–‡ä»¶ï¼š${fileName}`);
                    } catch (error) {
                        alert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼š' + error.message);
                        this.value = '';
                    }
                });
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„è‡ªå®šä¹‰é£æ ¼
            const savedStyleName = localStorage.getItem('customStyleName');
            if (savedStyleName) {
                document.getElementById('loadedStyleName').textContent = savedStyleName;
                document.getElementById('customStyleStatus').style.display = 'block';
            }
        });
    </script>
</body>
</html>